<html>
  <head>
    <script src="WebBridgeSDK2.js"></script>
    <script>
      class Calculator extends Service {
        constructor() {
          super("Calculator");
          this.registerMethod("add", 1, this.add.bind(this));
          this.registerMethod("sub", 1, this.sub.bind(this));
        }

        add(params) {
          console.log("add(" + JSON.stringify(params) + ")");
          return new Promise((resolve, reject) => {
            let sum = params.reduce((a, b) => a + b, 0);
            resolve(sum);
          });
        }

        sub(params) {
          console.log("sub(" + JSON.stringify(params) + ")");
          return new Promise((resolve, reject) => {
            let diff = params[0] - params[1];
            resolve(diff);
          });
        }
      }

      class TextProcessor extends Service {
        constructor() {
          super("TextProcessor");
          this.registerMethod("toupper", 1, this.toupper.bind(this));
          this.registerMethod("tolower", 1, this.tolower.bind(this));
        }

        toupper(params) {
          console.log("toupper(" + JSON.stringify(params) + ")");
          return new Promise((resolve, reject) => {
            resolve(params.toUpperCase());
          });
        }

        tolower(params) {
          console.log("tolower(" + JSON.stringify(params) + ")");
          return new Promise((resolve, reject) => {
            resolve(params.toLowerCase());
          });
        }
      }

      const service_manager = new ServiceManager();
      const server_address = "127.0.0.1";
      service_manager.open({"host":server_address, "port":55555, "namespace":"firebolt"})
        .then(() => {
          console.log("open succees.");
          service_manager.registerService(new Calculator());
          service_manager.registerService(new TextProcessor());
        }).catch(ex => {
          console.log(ex.error);
        });
    </script>
  </head>

  <body>
    Check the console window.
  </body>
</html>
